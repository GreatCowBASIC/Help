<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>I2CReceive</title><link rel="stylesheet" type="text/css" href="gcbdoc.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="GCBASIC documentation"><link rel="up" href="_i2c_software.html" title="I2C Software"><link rel="prev" href="_i2cackpoll.html" title="I2CAckpoll"><link rel="next" href="_i2creset.html" title="I2CReset"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_i2creceive"></a>I2CReceive</h4></div></div></div><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="screen">  I2CReceive <span class="emphasis"><em>data</em></span>
  I2CReceive <span class="emphasis"><em>data</em></span>, <span class="emphasis"><em>ack</em></span></pre><p><span class="strong"><strong>Command Availability:</strong></span></p><p>Available on all microcontrollers except 12 bit instruction Microchip PIC microcontrollers (10F,
12F5xx, 16F5xx chips)</p><p><span class="strong"><strong>Explanation:</strong></span></p><p>The I2CReceive command will send <code class="literal"><span class="emphasis"><em>data</em></span></code> through the I2C connection. If
<code class="literal"><span class="emphasis"><em>ack</em></span></code> is TRUE, or no value is given for <code class="literal"><span class="emphasis"><em>ack</em></span></code>, then <code class="literal">I2CReceive</code> will send
an ack.</p><p>If in master mode, <code class="literal">I2CReceive</code> will read the data immediately.</p><p>If in slave mode, <code class="literal">I2CReceive</code> will wait for the master to send the data
before reading. When the method <code class="literal">I2CReceive</code> is used in Slave mode the
global variable <code class="literal">I2CMatch</code> will be set to true when the received value is
equal to the constant <code class="literal">I2C_ADDRESS</code>.</p><p><span class="strong"><strong>Example 1 - Master Mode:</strong></span></p><pre class="screen">  ' I2C Receive - using the ChipIno board, see here for information. ' This program reads an I2C register and LED is set to on if the value  is over 100.
  ' This program will read from address 83, register 1.

  #chip 16F886, 8
  #config MCLRE_ON

  'I2C settings
  #define I2C_MODE Master
  #define I2C_DATA PORTC.4
  #define I2C_CLOCK PORTC.3

  'Misc settings
  #define LED PORTB.5
  dir LED Out

  'Main loop
  Do
    'Send start
    I2CStart

    'Request value
    I2CSend 83
    I2CSend 1

    'Read value
    I2CReceive ValueIn

    'Send stop
    I2CStop

    'Turn on LED if received value &gt; 100
    Set LED Off
    If ValueIn &gt; 100 Then Set LED On

    'Delay
    Wait 20 ms

  Loop</pre><p><span class="strong"><strong>Example 2 - Slave Mode:</strong></span></p><p>See the <a class="link" href="_i2c_overview.html" title="I2C Overview">I2C Overview</a> for the
Master mode device to control this Slave mode device.</p><pre class="screen">  ' I2CReceive_Slave.gcb - using a 16F88.
  ' This program receives commands from a GCB Master. This Slave has three LEDs attached.

  ;----- Configuration

  #chip 16F88, 8
  #config MCLR_OFF


  #define I2C_MODE    Slave     ;this is a slave device now
  #define I2C_CLOCK   portb.4    ;SCL on pin 10
  #define I2C_DATA    portb.1    ;SDA on pin 7
  #define I2C_ADDRESS 0x60      ;address of the slave device

  ;----- Variables

  dim addr, reg, value as byte

  ;----- Program
  #define LED0  porta.2          ;pin 1
  #define LED1  porta.3          ;pin 2
  #define LED2  porta.4          ;pin 3

  dir LED0 out                  ;0, 1 and 2 are outputs (LEDs)
  dir LED1 out                  ;0, 1 and 2 are outputs (LEDs)
  dir LED2 out                  ;0, 1 and 2 are outputs (LEDs)

  do
    I2CStart                 ;wait for Start signal
    I2CReceive( addr )         ;then wait for an address

    if I2CMatch  = true then    ;if it matches, proceed

    I2CReceive(regval, ACK)   ;get the register number
    I2CReceive(value, ACK)    ;and its value
    I2CStop                   ;release the bus from this end

    select case regval        ;now turn proper LED on or off
      case 0:
      if value then
        set LED0 on
      else
        set LED0 off
      end if

      case 1:
      if value then
        set LED1 on
      else
        set LED1 off
      end if

      case 2:
      if value then
        set LED2 on
      else
        set LED2 off
      end if
      case else
           ;other register numbers are ignored
    end select
    else
     I2CStop           ;release bus in any event
    end if

  loop</pre><p>Supported in &lt;I2C.H&gt;</p></div></body></html>