<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Inputs/Outputs</title><link rel="stylesheet" type="text/css" href="gcbdoc.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="GCBASIC documentation"><link rel="up" href="_microcontroller_fundamentals.html" title="Microcontroller Fundamentals"><link rel="prev" href="_microcontroller_fundamentals.html" title="Microcontroller Fundamentals"><link rel="next" href="_configuration.html" title="Configuration"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_inputs_outputs"></a>Inputs/Outputs</h3></div></div></div><p><span class="strong"><strong>About Inputs and Outputs</strong></span></p><p>Most general purpose pins on a microcontroller can function in one of
two modes: input mode, or output mode.</p><p>When acting as an input, the general purpose input/output pin will be placed in a high impedance state.
The microcontroller will then sense the general purpose input/output pin, and the program can read
the state of the general purpose input/output pin and make decisions based on it.</p><p>When in output mode, the microcontroller will connect the general purpose input/output pin to either
Vcc (the positive supply), or Vss (ground, or the negative supply). The
program can then set the state of the general purpose input/output pin to either high or low.</p><p>GCBASIC will attempt to determine the direction of each general purpose input/output pin, and set it
appropriately, when possible. GCBASIC will try to set the direction of the general purpose input/output pin.
However, if the general purpose input/output pin is read from and written to in your program, then
the general purpose input/output pin must be configured to input or output mode by the program, using
the appropriate <a class="link" href="_dir.html" title="Dir">Dir</a> commands.</p><p>Example of <code class="literal">dir</code> commands.</p><pre class="screen">    'The port address is microcontroller specific.  Portx.x is a general case for PICs and AVRs
    dir portb.0 in
    dir portb.1 out

    'The port address is microcontroller specific.  gpiox.x is a general case for some PICs
    dir gpio.0 in
    dir gpio.1 Out

    'Set the whole port as an output
    dir portb out
    dir gpio out

    'Set the whole port as an input
    dir portc in
    dir gpio in</pre><p><span class="strong"><strong>Microchip specifics for read/write operations</strong></span></p><p>For the specific ports and general purpose input/output pins available for a specific microcontroller please refer to the datasheet.</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th align="left" valign="top"><span class="strong"><strong>Port</strong></span></th><th align="left" valign="top"><span class="strong"><strong>Purpose</strong></span></th><th align="left" valign="top"><span class="strong"><strong>Example</strong></span></th></tr></thead><tbody><tr><td align="left" valign="top"><p>PORTx maps to the microcontrollers digital pins 0 to 7. Where x can be a,b,c,d,e,f or g</p></td><td align="left" valign="top"><p>Read:
</p><p>PORTx the port data register for a  read operation.</p></td><td align="left" valign="top"><p>uservar=PORTA
</p><p>uservar=PORTA.1</p></td></tr><tr><td align="left" valign="top"><p>PORTx maps to microcontrollers digital pins 0 to 7. Where x can be a,b,c,d,e,f or g</p></td><td align="left" valign="top"><p>Write:
</p><p>PORTx the port data register for a  write operation, and, where LATx is not required as GCBASIC will implement LATx when needed.
</p><p>See <a class="link" href="__option_nolatch.html" title="#Option NoLatch">Option NoLatch</a> for more information on LAT registers and how to disable this automatic function.</p></td><td align="left" valign="top"><p>PORTA=255
</p><p>PORTA.1=1</p></td></tr></tbody></table></div><p>To read a general purpose input/output pin, you need to ensure the direction is correct <code class="literal">DIR Portx IN</code> is set (default is IN) or a specific set of port bits.
Where <code class="literal">uservar = PORTx.n</code> can be used.</p><p>Examples:</p><pre class="screen">    uservar = PORTb.0
    uservar = PORTb</pre><p>To write to a general purpose input/output pin, you need to ensure the direction is correct <code class="literal">DIR Portx OUT</code> for port or a specific set of port bits.
Where  <code class="literal">PORTx.n = uservar</code> can be used.</p><p>Examples:</p><pre class="screen">    PORTb.0 = uservar
    PORTb = uservar</pre><p><span class="strong"><strong>ATMEL specifics for read/write operations</strong></span></p><p>Using a Mega328p as a general the following provides insights for the AVR devices.  For the specific ports and general purpose input/output pins available for a specific microcontroller please refer to the datasheet.</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th align="left" valign="top"><span class="strong"><strong>Port</strong></span></th><th align="left" valign="top"><span class="strong"><strong>Write operation</strong></span></th><th align="left" valign="top"><span class="strong"><strong>Read operation</strong></span></th></tr></thead><tbody><tr><td align="left" valign="top"><p>PORTD maps to Mega328p (and, the AVR microcontrollers) digital pins 0 to 7</p></td><td align="left" valign="top"><p>PORTD - The Port D Data Register - write operation  (a read operation to a port will provide the pull-up status)</p></td><td align="left" valign="top"><p>PIND - The Port D Input Pins Register - read only</p></td></tr><tr><td align="left" valign="top"><p>PORTB maps to Mega328p (and, the AVR microcontrollers) digital pins 8 to 13. The two high bits (6 &amp; 7) map to the crystal pins and are not usable</p></td><td align="left" valign="top"><p>PORTB - The Port B Data Register - write operation  (a read operation to a port will provide the pull-up status)</p></td><td align="left" valign="top"><p>PINB - The Port B Input Pins Register - read only</p></td></tr><tr><td align="left" valign="top"><p>PORTC maps to Mega328p (and, the AVR microcontrollers) analog pins 0 to 5. Pins 6 &amp; 7 are only accessible on the Mega328p (and, the AVR microcontrollers) Mini</p></td><td align="left" valign="top"><p>PORTC - The Port C Data Register - write operation (a read operation to a port will provide the pull-up status)</p></td><td align="left" valign="top"><p>PINC - The Port C Input Pins Register - read only</p></td></tr></tbody></table></div><p>To read a general purpose input/output pin, you need to ensure the direction is correct <code class="literal">DIR Portx IN</code> is set (default is IN) or a specific set of port bits.
Where <code class="literal">uservar = PINx.n</code> can be used and therefore to read data port use <code class="literal">uservar = PINx</code>.</p><p>Examples:</p><pre class="screen">    uservar = PINb.0
    uservar = PINb</pre><p>To write to a general purpose input/output pin you need to ensure the direction is correct <code class="literal">DIR Portx OUT</code> for port or a specific set of port bits.
Where <code class="literal">PORTx.n = uservar</code> can be used and therefore to write to a data port use <code class="literal">PORTx = uservar</code>.</p><p>Examples:</p><pre class="screen">    PORTb.0 = uservar
    PORTb = uservar</pre><p><br>
<br>
<span class="strong"><strong>Setting Ports and Port.bit</strong></span></p><p>You can set a port as shown above with a variable, or, you can set with a constant or any combination using the bitwise and logical operators.</p><pre class="screen">    #define InitStateofPort 0b11110000
    PORTb = InitStateofPort               'will unconditionally set bits 4:7

    PORTb = 0b11110000                    'will unconditionally set bits 4:7

    PORTb = uservar OR 0b11110000         'will OR bits 4:7 to ensure bits 4:7 are set</pre><p>The following is also valid - read a port.bit and then set port.bit with a variable or port value. As shown below.</p><pre class="screen">    dir portb out

    portb.0 = NOT  portb.0</pre><p>The user code above may cause issues with glitches when the read and write operations occurs.  Let us look at the generated assembler.</p><pre class="screen">    ;portb.0 = NOT  portb.0
      banksel SYSTEMP1
      clrf  SysTemp1
      btfsc PORTB,0
      incf  SysTemp1,F
      comf  SysTemp1,F
      bcf PORTB,0
      btfsc SysTemp1,0
      bsf PORTB,0</pre><p>To resolve any glitches add <code class="literal">#option Volatile</code> to your user code.</p><pre class="screen">    #option Volatile portb.0

    dir portb out

    portb.0 = NOT  portb.0</pre><p>This option provides the following assembler resolving the glitch issue.</p><pre class="screen">    ;portb.0 = NOT  portb.0
      banksel SYSTEMP1
      clrf  SysTemp1
      btfsc PORTB,0
      incf  SysTemp1,F
      comf  SysTemp1,F
      btfsc SysTemp1,0
      bsf PORTB,0
      btfss SysTemp1,0
      bcf PORTB,0</pre><p><br>
<br></p><p><span class="strong"><strong>See also</strong></span>  <a class="link" href="_dir.html" title="Dir">Dir</a>, <a class="link" href="__option_volatile.html" title="#Option Volatile">#Option Volatile</a></p><p><br>
<br></p></div></body></html>