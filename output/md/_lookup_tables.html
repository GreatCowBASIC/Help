<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Lookup Tables</title><link rel="stylesheet" type="text/css" href="gcbdoc.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="GCBASIC documentation"><link rel="up" href="_syntax.html" title="Syntax"><link rel="prev" href="_labels.html" title="Labels"><link rel="next" href="_miscellaneous.html" title="Miscellaneous"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_lookup_tables"></a>Lookup Tables</h3></div></div></div><p><span class="strong"><strong>About Lookup Tables</strong></span></p><p>A lookup table is a list of values that are stored in the memory of the microcontroller, which then can be accessed using the <code class="literal">ReadTable</code> command.</p><p>The advantage of lookup tables is that they are memory efficient,
compared to an equivalent set of alternative command statements.</p><p>Data tables are defined as follows:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">a single value on each line</li><li class="listitem">byte, word, longs and integer values are valid.&nbsp;&nbsp;</li><li class="listitem">Strings must be expressed as ASCII byte value(s)</li><li class="listitem">multiple elements on a single line separated by commas</li><li class="listitem">constants and calculations within the single line data table entries are permitted</li><li class="listitem">an external data source file</li><li class="listitem">decimal values are NOT supported
<br>
<br></li></ol></div><p><span class="strong"><strong>Defining Tables</strong></span></p><p><span class="emphasis"><em>Single data values</em></span></p><p>A single value on each line with in the table.&nbsp;&nbsp;The example table, shown below, has the data on different line in within the table.</p><pre class="screen">    Table TestDataSource
        12
        24
        36
        48
        60
        72
    End Table

    Dim TableCounter, Invalue as byte

    CLS
    For TableCounter = 1 to 6
      ReadTable  TestDataSource, TableCounter, Invalue
      Print InValue
      Print ","
    Next</pre><p><span class="emphasis"><em>Multiple data values of the same line</em></span></p><p>Multiple elements on a single line separated by commas.&nbsp;&nbsp;The example table, shown below, has the data separated by <code class="literal">,</code> and on different line in within the table.</p><pre class="screen">    Table TestDataSource
        12,  24, 36
        48,  60, 72
    End Table

    Dim TableCounter, Invalue as byte

    CLS
    For TableCounter = 1 to 6
      ReadTable  TestDataSource, TableCounter, Invalue
      Print InValue
      Print ","
    Next</pre><p><span class="emphasis"><em>Data values as constants, and, with data transformation</em></span></p><p>Constants and calculations within the single line.  &nbsp;&nbsp;The example table, shown below, uses a defined constant to multiple the data with the table.</p><pre class="screen">#define calculation_constant 2

    Table TestDataSource
      1 * calculation_constant
      2 * calculation_constant
      3 * calculation_constant
      8 * calculation_constant
      4 * calculation_constant
      5 * calculation_constant
    End Table

    Dim TableCounter, Invalue as byte

    CLS
    For TableCounter = 1 to 6
      ReadTable  TestDataSource, TableCounter, Invalue
      Print InValue
      Print ","
    Next</pre><p>&nbsp;&nbsp;
&nbsp;&nbsp;</p><p><span class="emphasis"><em>Data values as Strings</em></span></p><p>Strings can be defined.&nbsp;&nbsp;Strings are delimited by double quotes. &nbsp;&nbsp; The following examples show the methods.</p><p>Any ASCII characters between any two "    " (double quotes) will be converted to table data.&nbsp;&nbsp; Also see ASCII escape codes.</p><p>A source string can be one string per line or comma separated strings, therefore, on the same line.</p><p>Simple Example 1.</p><pre class="screen">    Table Test_1
     "ABCDEFGHIJ"
    End Table</pre><p>Simple Example 2.</p><pre class="screen">    '
    Table  MnuTxt_1  'Home disp
       "  Display_1    Display_2    Display_3  "
    End Table

    Table MnuTxt_2   'Main Menu
     "1: Display"       ' Main1
     "2: System Setup"  ' Main2
     "3: Config 1"      ' Main3
     "4: Config 2"      ' Main4
     "5: Data Log"      ' Main5
     "6: Diagnostic"    ' Main6
     "7: Help+"         ' Main7
    End Table</pre><p>The following 2 table lines produce the same table data.</p><pre class="screen">    "String1","String2", "String3"
    "String1String2String3"</pre><p>And, the following 3 table lines produce the same table data.</p><pre class="screen">    "String1"
    "String2"
    "String3"</pre><p><span class="emphasis"><em>ASCII Escape code</em></span></p><p>Accepted escape strings are shown in the table below.</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th align="left" valign="top">Escape sequence</th><th align="left" valign="top">Meaning</th></tr></thead><tbody><tr><td align="left" valign="top"><p>\a</p></td><td align="left" valign="top"><p>beep</p></td></tr><tr><td align="left" valign="top"><p>\b</p></td><td align="left" valign="top"><p>backspace</p></td></tr><tr><td align="left" valign="top"><p>\f</p></td><td align="left" valign="top"><p>formfeed</p></td></tr><tr><td align="left" valign="top"><p>\l or \n</p></td><td align="left" valign="top"><p>newline</p></td></tr><tr><td align="left" valign="top"><p>\r</p></td><td align="left" valign="top"><p>carriage return</p></td></tr><tr><td align="left" valign="top"><p>\t</p></td><td align="left" valign="top"><p>tab</p></td></tr><tr><td align="left" valign="top"><p>\0</p></td><td align="left" valign="top"><p>Nul value, equates to ASCII 0. Same as \&amp;000</p></td></tr><tr><td align="left" valign="top"><p>\&amp;nnn</p></td><td align="left" valign="top"><p>ascii char in decimal</p></td></tr><tr><td align="left" valign="top"><p>\\</p></td><td align="left" valign="top"><p>backslash</p></td></tr><tr><td align="left" valign="top"><p>\"</p></td><td align="left" valign="top"><p>double quote</p></td></tr><tr><td align="left" valign="top"><p>\'</p></td><td align="left" valign="top"><p>single quote</p></td></tr></tbody></table></div><p><span class="strong"><strong>Using Lookup Tables</strong></span></p><p>First, the table must be created. The code to create a lookup table is
simple - a line that has <code class="literal">Table</code> and then the name of the table, a list
of numbers (up to 10,000 elements), and then <code class="literal">End Table</code>.</p><p>For tables with more than 255 elements it is mandated to used a WORD variable to read the size of the table. See below for an example.</p><p>Once the table is created, the <code class="literal">ReadTable</code> command is used to read data
from it. The <code class="literal">ReadTable</code> command requires the name of the table it is to
read, the location of the item to retrieve, and a variable to store the
retrieved number in.</p><p>Lookup tables can store byte, word, longs and integer values.&nbsp;&nbsp;
GCBASIC will try automatically detect the type of the table depending on the values in it.&nbsp;&nbsp;
GCBASIC can be explicitly instructed to cast the table to a variable type, as follows:</p><pre class="screen">    Table TestDataSource as [Byte | Word | Integer | Long ]
        12
        24
        36
        48
        60
        72
    End Table</pre><p><span class="emphasis"><em>Addresssing the Table Data</em></span></p><p>Item 0 of a lookup table stores the size of the table.
If the <code class="literal">ReadTable</code> command attempts to read beyond the end (number of data items) of the table, the value 0 will be returned.
For tables with more than 255 elements it is <span class="strong"><strong>mandatory</strong></span> to use a WORD variable to read the size of the table. See example below.</p><pre class="screen">    dim lengthoftable as word

    readtable TestDataSource , 0, lengthoftable
    print lengthoftable  ; will print the size as a word

    table TestDataSource
    'a table with more than 255 elements
    ... 'item 1
    ...
    ...
    ...  'item 1027
    end table</pre><p><span class="emphasis"><em>Importing External Text File for table conversion</em></span></p><p>An external file can be used as the table data source.&nbsp;&nbsp;
The file will be read into the specified table name from the external file.&nbsp;&nbsp;
The source file will be treated as a byte value file.</p><p>An example file is shown below:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="./images/lookuptablesb1.PNG" align="middle" alt="graphic"></div></div><p>The following program will import the external data file.</p><pre class="screen">    #chip 16f877a

    Table TestDataSource from "sourcefile.raw"

    for nn = 1 to 10
      ReadTable TestDataSource, nn, inc
      Print inc
    next</pre><p>And the program will out the following:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="./images/lookuptablesb2.PNG" align="middle" alt="graphic"></div></div><p><br>
<br></p><p><span class="emphasis"><em>Advanced use of Lookup Tables - using EEPROM for Table data storage</em></span></p><p>You can use the <code class="literal">Table</code> statement to store the data table in EEPROM. If
the compiler is told to store a data table in "Data" memory, it will
store it in the EEPROM.</p><p><span class="strong"><strong>NOTE</strong></span>
The limitation of of using EPPROM tables is that you can only
store BYTEs. You cannot store WORD values in the EEPROM tables.</p><p>Example code:</p><pre class="screen">    #chip 16F628

    'Read table item
    'Must use ReadTable and a variable for the index, or the table will not be downloaded to EEPROM

    TableLoc = 2
    ReadTable TestDataSource, TableLoc, SomeVar

    'Write to table , this is not required
    EPWrite 1, 45

    'Table of values to write to EEPROM
    'EEPROM location 0 will store length of table
    'Subsequent locations will each store a value

    Table TestDataSource Store Data
        12
        24
        36
        48
        60
        72
    End Table</pre><p><br>
<br></p><p><span class="strong"><strong>For more help, see</strong></span> <a class="link" href="_readtable.html" title="ReadTable">ReadTable</a></p></div></body></html>