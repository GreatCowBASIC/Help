<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Tricks and Tips</title><link rel="stylesheet" type="text/css" href="gcbdoc.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="GCBASIC documentation"><link rel="up" href="index.html" title="GCBASIC documentation"><link rel="prev" href="_acknowledgements.html" title="Acknowledgements"><link rel="next" href="_uno_as_isp_programmer.html" title="UNO as ISP programmer"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a name="_tricks_and_tips"></a>Tricks and Tips</h2></div></div></div><p>This is a collation of tricks and tips that may be useful to you.
<br>
<br>
<a class="link" href="_tricks_and_tips.html#RAMVARIABLESANDRESETS">RAM, variables and resets</a></p><p><a class="link" href="_tricks_and_tips.html#FORNEXTLEGACY">Reverting the FOR-NEXT loop to the Legacy FOR-NEXT method</a></p><p><a class="link" href="_tricks_and_tips.html#REQUIRED">Change the compilers behaviour when the compiler states a capability is not available</a></p><p><a class="link" href="_tricks_and_tips.html#MINIMALASM">Create a minimal ASM source with no config and/or initsys</a></p><p><a class="link" href="_tricks_and_tips.html#PPSandUSARTs">PPS microconrollers and multiple USARTs</a>
<br>
<br></p><p><a name="RAMVARIABLESANDRESETS"></a><span class="strong"><strong>TIP: RAM, variables and resets</strong></span></p><p>When you define a variable it will be mapped to a RAM location.&nbsp;&nbsp;
As you develop your solution your should always do the following to ensure the variable are initialised correctly.&nbsp;&nbsp;</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Always initialise variables to a known state</li></ul></div><p>A variable will not show up in the ASM source code unless it is used somewhere in code. &nbsp;&nbsp;
Adding <code class="literal">Variable = 0</code>  will assure that the variable is initialised and will show up in the ASM.&nbsp;&nbsp;
This is very useful for troubleshooting.&nbsp;&nbsp;
This is essential when debugging ASM to look at variables that are defined using "EQU".&nbsp;&nbsp;
If you do not initialise or use the variable then the variable will not be shown in the EQU list of variables.&nbsp;&nbsp;
So, initialise all your variables.</p><div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">Always power cycle the microcontroller after programming</li></ul></div><p>A soft reset when debugging/testing/programming will not reset the RAM to a known state.
This is essential when debugging ASM to look at variables that are defined using "EQU".&nbsp;&nbsp;
A soft reset  does not change the contents of RAM.&nbsp;&nbsp;
Where a hard reset reverts ram back to an undefined /random state!&nbsp;&nbsp;
So, a power cycle is good practice.&nbsp;&nbsp;
<br>
<br></p><p><a name="FORNEXTLEGACY"></a><span class="strong"><strong>TRICK: Reverting the FOR-NEXT loop to the Legacy FOR-NEXT method ?</strong></span></p><p>Why do this?  To reduce the PROGMEM size.&nbsp;&nbsp;
But, you must assure yourself that the loop variable cannot overflow as the legacy FOR-NEXT does not prevent an overflow of the loop variable.</p><p>Some background.&nbsp;&nbsp;
In 2021 the GCBASIC compiler was updated to improve the operation of the FOR-NEXT loop.&nbsp;&nbsp;
The improvement did increase the size of the ASM generated.&nbsp;&nbsp;
The legacy FOR-NEXT loop had some major issues that included never ending loops, incorrect end loop and unexpected operations.&nbsp;&nbsp;
This was all caused by the compiler, not the user, and in 2021 the compiler was updated to resolve these issues.&nbsp;&nbsp;</p><p>However, there is a risk that the new FOR-NEXT method causes 1) larger ASM that will not fit in small microcontrollers or 2) the new code does not operate as expected.&nbsp;&nbsp;
In either case you can disable the new FOR-NEXT method by adding a constant as shown below.&nbsp;&nbsp;
Adding this constant will revert the FOR-NEXT loop asm generated to the legacy method.&nbsp;&nbsp;</p><pre class="screen">    #DEFINE USELEGACYFORNEXT</pre><p><br>
<br></p><p><a name="REQUIRED"></a><span class="strong"><strong>TRICK: How to change the compilers behaviour when the compiler states a capability is not available when I know it is ?</strong></span></p><p>The compiler is issuing an error message that a EEPROM, HEF, SAF, PWM16 or hardware USART is not available&#8230;&#8203; but, it is.&nbsp;&nbsp;</p><p>This is caused by the microcontroller DAT file.&nbsp;&nbsp;
The microcontroller DAT file is missing key information that informs the compiler that a specific capability is available.&nbsp;&nbsp;
This information was added to prevent silent failures where you could use a capability when it is not available.&nbsp;&nbsp;</p><p>The compiler thinks your microcontroller does not have the selected capability. &nbsp;&nbsp;
Simply use the table below to resolve.&nbsp;&nbsp;
Adding the constant defined to your source program.&nbsp;&nbsp;</p><p>Then, let us know via the Forum so we can correct the source microcontroller DAT file.
<br>
<br></p><div class="horizontal"><table border="0"><colgroup><col><col></colgroup><tbody valign="top"><tr><td valign="top">
<p>EEPROM</p>
</td><td valign="top">
<p><code class="literal">#DEFINE CHIPEEPROM = 1</code></p>
</td></tr><tr><td valign="top">
<p>HEF</p>
</td><td valign="top">
<p><code class="literal">#DEFINE  CHIPHEFWORDS = 128</code></p>
</td></tr><tr><td valign="top">
<p>SAF</p>
</td><td valign="top">
<p><code class="literal">#DEFINE  CHIPSAFWORDS = 128</code></p>
</td></tr><tr><td valign="top">
<p>PWM16</p>
</td><td valign="top">
<p><code class="literal">#DEFINE  CHIPPWM16TYPE  = 1</code></p>
</td></tr><tr><td valign="top">
<p>USART hardware</p>
</td><td valign="top">
<p><code class="literal">#DEFINE  CHIPUSART  = 1</code></p>
</td></tr></tbody></table></div><p><br>
<br></p><p><a name="MINIMALASM"></a><span class="strong"><strong>TRICK: How do I create a minimal ASM source with no config and/or initsys?</strong></span></p><p>Very easy.&nbsp;&nbsp;
Simple add two <code class="literal">#OPTION</code> statements.&nbsp;&nbsp;</p><p><code class="literal">#OPTION UserCodeOnly ENTERBOOTLOADER:</code> &nbsp;&nbsp;This will instruct the compiler to NOT call the INITSYS() method.&nbsp;&nbsp;
And, to jump to a label.&nbsp;&nbsp;
The label is mandated.&nbsp;&nbsp;The label specified will be included in the ASM generated.</p><p><code class="literal">#OPTION NoConfig</code>&nbsp;&nbsp;This will instruct the compiler to NOT add the microcontroller specific config statements.</p><p>Example:</p><pre class="screen">    #chip 16f877a, 4
    #OPTION Explicit

    #OPTION UserCodeOnly ENTERBOOTLOADER:
    #OPTION NoConfig

    ENTERBOOTLOADER:</pre><p>The example above yields the following asm.&nbsp;&nbsp;
Comment lines have been removed for clarity.</p><pre class="screen">     LIST p=16F877A, r=DEC
    #include &lt;P16F877A.inc&gt;

    ;Vectors
      ORG 0
      pagesel ENTERBOOTLOADER
      goto  ENTERBOOTLOADER

    ;ORG 5


    ENTERBOOTLOADER

    ;ORG 2048
    ;ORG 4096
    ;ORG 6144

     END</pre><p><a name="PPSandUSARTs"></a><span class="strong"><strong>TIP: PPS and multiple USARTs</strong></span></p><p>You can set up multiple pins to simultaneously operate as a peripheral output on microcontrollers with Peripheral Pin Select (PPS).
<br>
<br>
PPS microcontrollers can set up to simultaneously output specific modules.&nbsp;&nbsp;
The example below shows the method to output two TX ports.&nbsp;&nbsp;
Hardware Serial (TX1) data will now be output on both B.6 and C.6
<br>
<br></p><pre class="screen">    Sub InitPPS
            'Module: UART pin directions
            Dir PORTC.6 Out    ' Make TX1 pin an output
            Dir PORTB.6 Out    ' Make TX1 pin an output
            'Module: UART1 to two ports
            RC6PPS = 0x0020    'TX1 &gt; RC6
            RB6PPS = 0x0020    'TX1 &gt; RB6

    End Sub</pre></div></body></html>