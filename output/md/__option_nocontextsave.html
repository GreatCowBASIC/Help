<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>#Option NoContextSave</title><link rel="stylesheet" type="text/css" href="gcbdoc.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="GCBASIC documentation"><link rel="up" href="_compiler_options.html" title="Compiler Options"><link rel="prev" href="__option_bootloader.html" title="#Option Bootloader"><link rel="next" href="__option_nolatch.html" title="#Option NoLatch"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="__option_nocontextsave"></a>#Option NoContextSave</h3></div></div></div><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="screen">    #option NoContextSave</pre><p><span class="strong"><strong>Explanation:</strong></span></p><p>Interrupts can occur at almost any time, and may interrupt another command as it runs. To ensure that the interrupted command can continue properly after the interrupt, some temporary variables (the context) must be saved.
Normally GCBASIC will do this automatically, but in some cases it may be necessary to prevent this. If porting some existing assembly code to GCBASIC, or creating a bootloader using GCBASIC that will call another program,</p><p><code class="literal">NoContextSave</code> can be used to prevent the context saving code from being added automatically.</p><p>Be very careful using this option - it is very easy to cause random corruption of variables. If creating your own context saving code, you may need to save several variables. These are:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">For Microchip PIC microcontrollers 12F/16F: W, STATUS, PCLATH</li><li class="listitem">For Microchip PIC microcontrollers 12F1/16F1/18F: W, STATUS, PCLATH, PCLATU, BSR</li><li class="listitem">For Atmel AVR microcontrollers: All 32 registers</li></ol></div><p>Other variables may also need to be saved, depending on what commands are used inside the interrupt handler.   Everything that is saved will also need to be restored manually when the interrupt handler finishes.</p><p><span class="strong"><strong>Example:</strong></span></p><pre class="screen">    ' This shows an example that could be used by a bootloader to call some application code.

    ' The application code must deal with context save and restore
    ' Suppose that application code starts at location 0x100, with interrupt vector at 0x108

    'Chip model
    #chip 18F2620

    'Do not save context automatically
    #option NoContextSave

    'Main bootloader routine
    Set PORTB.0 On
    'Do other stuff to make this an actual bootloader and not a trivial example
    'Transfer control to application code
    goto 0x100

    'Interrupt routine - this will be placed at the interrupt vector
    Sub Interrupt
        'If any interrupt occurs, jump straight to application interrupt vector
        goto 0x108
    End Sub</pre></div></body></html>