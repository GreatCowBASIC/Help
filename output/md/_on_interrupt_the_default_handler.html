<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>On Interrupt: The default handler</title><link rel="stylesheet" type="text/css" href="gcbdoc.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="GCBASIC documentation"><link rel="up" href="_interrupts.html" title="Interrupts"><link rel="prev" href="_on_interrupt.html" title="On Interrupt"><link rel="next" href="_keypad.html" title="Keypad"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_on_interrupt_the_default_handler"></a>On Interrupt: The default handler</h4></div></div></div><p><span class="strong"><strong>Introduction</strong></span></p><p>GCBASIC supports a default interrupt handler in two modes:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">You can define the interrupt flags and the default handler (a sub routine) will executed</li><li class="listitem">You can define an On Interrupt  event Call handler  where the handler is executed that matches the event
and where all other define/valid events are handled by the default handler (a sub routine),
The easiest way to write an interrupt handler is to write it in GCBASIC in conjunction with the On Interrupt statement.
On Interrupt tells microcontroller to activate its internal interrupt handling and to jump to a predetermined interrupt
handler (a sub routine that has been defined) when the interrupt handler (the sub routine) has completed processing returns
to correct address in the program.  See <a class="link" href="_on_interrupt.html" title="On Interrupt">On Interrupt</a>.</li></ol></div><p>This method of supports the handling interrupts by enabling a default interrupt subroutine.</p><p><span class="strong"><strong>Example 1</strong></span></p><p>This example shows if an event occurs the microcontroller will be program to jump to the interrupt vector and the program will not know the event type, it will simple execute the Interrupt subroutine.
This code is not intended as a meaningful solution and intended to show the functionality only.
An LED is attached to PORTB.1 via a suitable resistor.  It will light up when the Interrupt event has occurred.</p><pre class="screen">    #chip 16f877a, 4
    dir PORTB.1 out
    Set PORTB.1 Off

    'Note: there is NO On Interrupt handler
    InitTimer1 Osc, PS1_8
    SetTimer 1, 1
    StartTimer 1
    'Manually set Timer1Overflow to the overflow event
    'this will event will be handled by the Interrupt sub routine
    TMR1IE = 1
    end

    Sub Interrupt
      Set PORTB.1 On
      TMR1IF = 0
    End Sub</pre><p><span class="strong"><strong>Example 2</strong></span></p><p>Any events that are not dealt with by On Interrupt will result in the code in the Interrupt subroutine executing.
This example shows the operation of two interrupt handlers - is not intended as a meaningful solution.</p><p>LEDs are attached to PORTB.1 and PORTB.2 via suitable resistors.  They will light up when the Interrupt events occur.</p><pre class="screen">    #chip 16f877a, 4
    On Interrupt Timer1Overflow call Overflowed

    dir PORTB.1 out
    Set PORTB.1 Off

    dir PORTB.2 out
    Set PORTB.2 Off

    InitTimer1 Osc, PS1_8
    SetTimer 1, 1
    StartTimer 1

    InitTimer2 PS2_16, PS2_16
    SetTimer 2, 255
    StartTimer 2

    'Manually set Timer2Overflow to create a second event
    'this will event will be handled by the Interrupt sub routine
    TMR2IE = 1
    end

    Sub Interrupt
      Set PORTB.2 On
      TMR2IF = 0
    End Sub

    Sub Overflowed
      Set PORTB.1 On
      TMR1IF = 0
    End Sub</pre></div></body></html>