<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>GCBASIC Maintenance</title><link rel="stylesheet" type="text/css" href="gcbdoc.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="GCBASIC documentation"><link rel="up" href="_gcbasic_maintenance_and_development.html" title="GCBASIC Maintenance and Development"><link rel="prev" href="_gcbasic_maintenance_and_development.html" title="GCBASIC Maintenance and Development"><link rel="next" href="_development_guide.html" title="Development Guide"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_gcbasic_maintenance"></a>GCBASIC Maintenance</h3></div></div></div><p><span class="strong"><strong>Introduction:</strong></span>
GCBASIC maintenance covers the key processes that the developers use to maintain and build the solution.</p><p>These insights are not distribution specific.</p><p><span class="strong"><strong>Solution Architecture:</strong></span>
These components are key for a complete solution:</p><div class="orderedlist"><ol class="orderedlist" type="1"><li class="listitem">GCBASIC installer</li><li class="listitem">GCBASIC chip specific .DAT files</li><li class="listitem">GCBASIC Help</li><li class="listitem">GCBASIC IDE</li></ol></div><p><br>
<br>
<span class="strong"><strong>GCBASIC installers:</strong></span>
<br>
<br>
The Windows GCBASIC installer uses the <span class="emphasis"><em>InnoSoft</em></span> installer with packaging completed using R2Build.<br></p><p>The process uses a Gold build structure.  The R2Build software creates four packages for Windows and one package for the Linux distribution.  The process is automated with automatic versioning and configuration.</p><p>The macOS GCBASIC installer uses the <span class="emphasis"><em>Packages</em></span> installer (<a class="link" href="http://s.sudre.free.fr/Software/Packages/about.html" target="_top">http://s.sudre.free.fr/Software/Packages/about.html</a>) with packaging completed using the Bourne shell script <code class="literal">pkg2dmg.sh</code> to create a compressed disk image file containing the installer.</p><p><br>
<br>
<span class="strong"><strong>GCBASIC chip specific .DAT files:</strong></span>
<br>
<br>
What are the .DAT files?</p><p>The DAT files are the GCBASIC representation of the capabilities of a specific microcontroller.&nbsp;&nbsp;The DAT is based upon a number of vendor sources and corrections/omissions added by the GCBASIC development team.&nbsp;&nbsp;The DAT file is exposed to the user program as a set of registers and register bits that can used to configure the program in terms of the microcontroller specifics.
<br>
<br></p><p>The process to create the .DAT file for microcontrollers is as follows:</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th align="left" valign="top">Step</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p>1</p></td><td align="left" valign="top"><p>Obtain the MPASM *.INC or the AVR *.XML files to be used. These files determine the scope of registers and register bits.</p></td></tr><tr><td align="left" valign="top"><p>2</p></td><td align="left" valign="top"><p>For Microchip only.  Place the source INC files in the ..DAT\incfiles\OrgFiles.
</p><p>Process the file using 'Preprocess.bat'. &nbsp;&nbsp; This is an AWK text processor - you will need AWK.EXE in the executing folder.
</p><p>This preprocessing will examine all the INC files in the ..DAT\incfiles\OrgFiles folder.&nbsp;&nbsp;The resulting files will be placed in the ..DAT\incfiles folder.&nbsp;&nbsp;The resulting files will have the 'BITS' section sorted in port priority - this priority ensures the bits are assigned in the target DAT in the same order every time.</p></td></tr><tr><td align="left" valign="top"><p>3</p></td><td align="left" valign="top"><p>Update the database of support microcontrollers.&nbsp;&nbsp;This database contains the microcontroller configuration that GCBASIC requires as the core information for the DAT files.
</p><p>The database is called <code class="literal">chipdata.csv</code> or <code class="literal">avr_chipdata.csv</code> for Microchip and AVR respectively.
- These files are comma delimited.&nbsp;&nbsp;The first row of data specifies the field name - these field names control the chip conversion program, see later notes.&nbsp;&nbsp;
</p><p>The database fields are controlled by the GCBASIC development team and the specification of the database may change between releases to support new capabilities.
</p><p>Database fields will have the suffix of <code class="literal">Variant</code> such as PWMTimerVariant and SMTClockSourceVariant and are microcontroller specific configuration settings to support the various microcontroller settings.&nbsp;&nbsp;The values of these <code class="literal">variants</code> are determined by the examination of the microcontroller datasheets as this information is NOT specified in the source files.&nbsp;&nbsp;Variants are exposed in the user program with the prefix of Chip.&nbsp;&nbsp;If the variant is called <code class="literal">PWMTimerVariant</code> a constant called <code class="literal">ChipPWMTimerVariant</code> will be exposed in the user program.</p></td></tr><tr><td align="left" valign="top"><p>4</p></td><td align="left" valign="top"><p>Update the <code class="literal">CriticalChanges.txt</code> file, if required.&nbsp;&nbsp;The <code class="literal">CriticalChanges.txt</code> file contains changes to the INC file during processing that are corrections or additions to the source files.
</p><p>The format of each line is the <code class="literal">filename</code> , <code class="literal">Append (new line) or Replace</code>, <code class="literal">find</code>, <code class="literal">replace</code>.
</p><p>Each line is comma delimited and spaces are NOT critical.  &nbsp;&nbsp;Essentially, the processing with find a partial line and replace or append the whole line.
</p><p>example:  p16lf1615.inc,R,OSCFIE          EQU  H'0007',OSFIE           EQU  H'0007'&nbsp;&nbsp;&nbsp;&nbsp;
- so, when processing p16lf1615.inc find the line OSCFIE          EQU  H'0007' and replace with OSFIE           EQU  H'0007'.</p></td></tr><tr><td align="left" valign="top"><p>5</p></td><td align="left" valign="top"><p>If required.  &nbsp;&nbsp;This is not normally edited. &nbsp;&nbsp; Update the <code class="literal">18FDefaultASMConfig.txt</code> to set the 18f configuration defaults.</p></td></tr><tr><td align="left" valign="top"><p>6</p></td><td align="left" valign="top"><p>Maintain the conversion program.&nbsp;&nbsp;The conversion program may require maintenance. &nbsp;&nbsp;The programs are written in FreeBASIC and therefore require compilation.
</p><p>An example of maintenance is a new variant field is required.&nbsp;&nbsp;The source program will need to be updated to support the new variant - simply edit the source, compile and publish.&nbsp;&nbsp;Another example is the addition of a new Interrupt - follow the same process to edit, compile and publish.</p></td></tr><tr><td align="left" valign="top"><p>7</p></td><td align="left" valign="top"><p>Execute the program to convert the source files to the DAT files for Microchip or AVR.&nbsp;&nbsp;There are two programs for each architecture.
</p><p>Executing the conversion program without a parameter will process ALL the entries in the database (the csv file), passing a single parameter to the conversion program will only convert the single microcontroller.
</p><p>The conversion program will process as follows:
</p><p>a) Read the database for the chip specifics
</p><p>b) If a .DEV file or .INFO file is not present a routine called GuessDefaultConfig is invoked.  This method sets the bit(s).
</p><p>In all cases the default mask is sometimes specified for a particular config option and that is used for ASMConfig
</p><p>See the section below for the processing of a .DEV file.
</p><p>c) For all microcontrollers read the <code class="literal">CriticalChanges.txt</code> file and process.
</p><p>d) For 18f microcontrollers read the <code class="literal">18FDefaultASMConfig.txt</code>.  This simply overwrites all options stated in 18FDefaultASMConfig.TXT  and marks this in the output DAT file.
</p><p>e) Create the output DAT file.</p></td></tr><tr><td align="left" valign="top"><p>8</p></td><td align="left" valign="top"><p>Test and publish the DAT file(s) to the distribution as required.</p></td></tr></tbody></table></div><p><span class="strong"><strong>An example the processing of a .DEV</strong></span>.</p><p>This is the 18F25K20 example.   For this microcontroller <code class="literal">Disabled</code> is default:</p><div class="informalfigure"><div class="mediaobject" align="center"><img src="./images/xml2.PNG" align="middle" alt="graphic"></div></div><p class="text-left"><br>
<br>
Where the default is selected from the Info_Type.
<br>
<br></p><p><span class="strong"><strong>Prog = .  An explanation of the parameter</strong></span>.
The Prog value is measured in words. It is the same in the device specific.dat files.
<br></p><p>Microchip in the past have used words, but then they started using bytes on the website instead to make their chips appear to have larger capacity.
<br></p><p>An example: If a device has 8192 words, which is 8192 * 14 = 114688 bits, or 14336 bytes.&nbsp;&nbsp;It is an odd measurement because dividing 14336 by 14/8 to see how many instructions you can use is extra maths work within the compiler.
<br></p><p>The GCBASIC PROGram memory analysis are in words.
<br></p><p><br></p></div></body></html>