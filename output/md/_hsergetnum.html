<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>HSerGetNum</title><link rel="stylesheet" type="text/css" href="gcbdoc.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="GCBASIC documentation"><link rel="up" href="_rs232_hardware.html" title="RS232 (hardware)"><link rel="prev" href="_rs232_hardware_overview.html" title="RS232 Hardware Overview"><link rel="next" href="_hsergetstring.html" title="HSerGetString"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section"><div class="titlepage"><div><div><h5 class="title"><a name="_hsergetnum"></a>HSerGetNum</h5></div></div></div><p><span class="strong"><strong>Syntax:</strong></span></p><pre class="screen">  <code class="literal">HSerGetNum</code> <span class="emphasis"><em>myNum</em></span>    &#8216;Gets a multi digit number  from USART 1
  <code class="literal">HSerGetNum</code> <span class="emphasis"><em>myNum</em></span>,1  &#8216;Get a multi digit number from USART 1
  <code class="literal">HSerGetNum</code> <span class="emphasis"><em>myNum</em></span>,2  &#8216;Get a multi digit number from USART 2</pre><pre class="literallayout">When the variable type is a word the number range is 0 to 65535
When the variable type is a long the number range is 0 to 99999</pre><p><span class="strong"><strong>Command Availability:</strong></span></p><p>Available on all microcontrollers with a USART or UART module.<br></p><p>Microchip PIC supports USART1 and 2.<br>
Atmel AVR supports USART 1,2,3 and 4.</p><p><span class="strong"><strong>Enabling Constants:</strong></span></p><p>To enable the use of the USART these are the enabling constants. &nbsp;&nbsp;These constants are required.&nbsp;&nbsp;You can change the <code class="literal">USART_BAUD_RATE</code> and to meet your needs.&nbsp;&nbsp;For addition USART ports use <code class="literal">#define USART<span class="strong"><strong>n</strong></span>_BAUD_RATE 9600</code> where <code class="literal"><span class="strong"><strong>n</strong></span>`</code> is the required port number.</p><pre class="screen">    'USART settings for USART1
    #define USART_BAUD_RATE 9600
    #define USART_TX_BLOCKING
    #define USART_DELAY OFF</pre><p><span class="strong"><strong>Explanation:</strong></span></p><p>This command will read a multi digit number received as ascii chars followed by a CR from an external serial source using a  hardware serial module.  The command checks that only numbers are input disregarding other characters while waiting for the ending &lt;CR&gt;.  It can be used only as a subroutine.</p><p><span class="strong"><strong>Example:</strong></span></p><pre class="screen">  'This program receives a number and CR from a PC terminal and sends it back on both usarts
  #chip 18f26k22, 16

  'Set the pin directions
  #define USART_BAUD_RATE 9600
  #define USART_BLOCKING
  #define USART2_BAUD_RATE 9600
  #define USART2_BLOCKING

  'Init pins
  #define SerInPort PORTc.7    'usart1 in
  #define SerOutPort PORTc.6    'usart2 out
    'Set pin directions
    Dir SerOutPort Out
    Dir SerInPort In
    Dir PORTB.6 Out            'USART2 out
    Dir PORTB.7 In            'USArt2 in
    Dir PORTB.0 Out            'leds for testing
    Dir PORTB.1 Out            'leds for testing
    Wait 100 Ms

  'Variables
  Dim myNum as Word
  'Main body of program commences here.
  'Message after reset
  HSerPrint "18F26k22"
  HSerPrintCRLF

  'Main routine
  Do forever
    'wait for char from UART
    'HSerReceive InChar
    HSerGetNum myNum,2    'from usart 2
    HSerPrint myNum,1            ' send out usart 1
    HSerPrint myNum,2        'send out usart 2
    HSerPrintCRLF 1,2        'send one CRLF out usart 2
    HserPrintCRLF 1,1        &#8216;send one CRLF out usart 1
  loop</pre><p><span class="strong"><strong>Example:</strong></span>
This program receives number on serial port 1 and displays.  This example shows using a Long as the input variable.</p><p>Therefore, the result is in the range of 0-99999.  The example also shows how to detect a buffer overrun by testing the HSerInByte variable.</p><pre class="screen">    #chip mega328p, 16

    #define USART_BAUD_RATE 9600
    #define USART_BLOCKING

    Dim myNum as Long  ' range 0 to 99999
    HSerPrint "Restarted"
    HSerPrintCRLF

    Do
      HSerGetNum myNum
      HSerPrint myNum

      if HSerInByte &lt;&gt; 13 then
          HSerSend 9
          HSerPrint "Error buffer overrun"  'You should handle error appropiately
      End if
      HSerPrintCRLF
    loop
    End</pre><p><span class="strong"><strong>See also</strong></span> <a class="link" href="_hserreceive.html" title="HSerReceive">HSerReceive</a> and <a class="link" href="_hsergetstring.html" title="HSerGetString">HSerGetString</a></p></div></body></html>