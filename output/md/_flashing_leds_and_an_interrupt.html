<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Flashing LEDs and an Interrupt</title><link rel="stylesheet" type="text/css" href="gcbdoc.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="GCBASIC documentation"><link rel="up" href="_example_programs.html" title="Example Programs"><link rel="prev" href="_example_programs.html" title="Example Programs"><link rel="next" href="_flashing_led_with_timing_parameters.html" title="Flashing LED with timing parameters"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_flashing_leds_and_an_interrupt"></a>Flashing LEDs and an Interrupt</h3></div></div></div><p><span class="strong"><strong>Explanation:</strong></span></p><p>This code implements four flashing LEDs. This is based on the Microchip PIC Low Pin Count Demo Board.</p><p>The example program will blink the four red lights in succession. Press the Push Button Switch, labeled <span class="strong"><strong>SW1</strong></span>, and the sequence of the lights will reverse. Rotate the potentiometer, labeled <span class="strong"><strong>RP1</strong></span>, and the light sequence will blink at a different rate.</p><p>This implements an interrupt for the switch press, reads the analog port and set the LEDs.</p><p><span class="strong"><strong>Demonstration program:</strong></span></p><pre class="screen">    #chip 18F14K22, 32
    #config MCLRE_OFF

    'Works with the low count demo board

    'Set the input pin direction
        #define SwitchIn1 PORTa.3
        Dir SwitchIn1 In

    #define LedPort PORTc
        DIR PORTC OUT

    'Setup the ADC  pin direction
        Dir PORTA.0 In
        dim ADCreading as word


    'Setup the input pin direction
        #define IntPortA PORTA.1
        Dir IntPortA In

    'Variable and constants
        #define intstate as byte
        intstate = 0
        #define minwait 1

        dim ccount as byte
        dim leddir as byte

        ccount = 8
        leddir = 0

        SET PORTC = 15
        WAIT 1 S

        SET PORTC = 0

    'Setup the Interrupt
        Set IOCA.3 on
        Dir porta.3 in
        On Interrupt PORTABCHANGE Call Setir

    'Set initial LED direction
        setLedDirection

    DO FOREVER


        INTON
        ADCreading = ReadAD10(AN0)
        if ADCreading &lt; minwait then ADCreading = minwait

        'Set LEDs
        Set PortC = ccount
        wait ADCreading ms

        if leddir = 0 then
          rotate ccount left simple
          'Restart LED position
          if ccount = 16 then
              ccount = 128
          end if

        end if

        if leddir = 1 then
          rotate ccount Right simple
          'Restart LED position
          if ccount = 128 then
            ccount = 8
          end if

        end if
        'Reset interrupt - this may be been reset so set to zero so interrupt can operate.
        intstate = 0

    Loop


    'Interrupt routine.
    sub Setir

        if IntPortA  = 0 and intstate = 0 then
          intstate = 1
          wait while SwitchIn1 = 0
          setLedDirection
        end if


    end sub

    sub setLedDirection

      'Set LED values
      select case leddir

        case 0
          leddir = 1
          ccount  = 8

        case 1
          leddir = 0
          ccount = 1

        end select

    End Sub</pre><p><span class="strong"><strong>See Also</strong></span> <a class="link" href="_interrupts.html" title="Interrupts">Interrupts</a>, <a class="link" href="_readad10.html" title="ReadAD10">ReadAD10</a></p></div></body></html>