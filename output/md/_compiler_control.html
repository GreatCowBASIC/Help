<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>Compiler Control</title><link rel="stylesheet" type="text/css" href="gcbdoc.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="GCBASIC documentation"><link rel="up" href="_gcbasic_compiler_insights.html" title="GCBASIC Compiler Insights"><link rel="prev" href="_compiler_insights.html" title="Compiler Insights"><link rel="next" href="_libraries_overview.html" title="Libraries Overview"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section"><div class="titlepage"><div><div><h3 class="title"><a name="_compiler_control"></a>Compiler Control</h3></div></div></div><p>The compiler can be controlled, in terms of the default startup library routines.&nbsp;&nbsp;This may be required to implement a specific control function, or, to disable a default startup behaviour.</p><p><span class="strong"><strong>Scenario #1</strong></span>:</p><p>You have a new LCD.&nbsp;&nbsp;The GCBASIC LCD routines fail to initialise.&nbsp;&nbsp;You want to write your own LCD initialise routine, but you want to ensure the GCBASIC standard INITLCD() does not operate before your own LCD initialise routine.&nbsp;&nbsp;How to do this?</p><p><span class="strong"><strong>Scenerio #2</strong></span>:</p><p>You want to write your own INITSYS routine.&nbsp;&nbsp;  You can add your own routine to initialise the microntroller but the default INITSYS would always be called in the ASM.</p><p>In the first sceneria the approach would be to redirect the GCBASIC standard INITLCD() to myInitLCD using #define INITLCD myINITLCD.&nbsp;&nbsp;  However, prior to the latest build, this would fail to work.&nbsp;&nbsp;The reason for the failure to redirect to your new routine is the #startup INITLCD directive.&nbsp;&nbsp;The #startup directive was essentially hard coded and all the #startup(s) could not be changed.</p><p>In the second scenerio the ASM call to INITSYS is also hard coded.&nbsp;&nbsp;And, you could trick the compiler to call your own initialisation routine but this was not easy and not intuitive.&nbsp;&nbsp;</p><p>The new build now supports the updating of the #startup(s) with your own routines, or even to cancel #startup(s).</p><p><span class="strong"><strong>Examples:</strong></span></p><p>The compiler will search for all #startup(s) and update across all sources (libraries and includes).&nbsp;&nbsp;LCD.H is just an example.</p><p><code class="literal">#DEFINE INITLCD myINITLCD</code> // This will change any reference in the LCD.h #startup INITLCD to #startup myINITLCD.</p><p><code class="literal">#DEFINE INITLCD</code> // With no second parameter would cancel any #startup in LCD.h.</p><p><code class="literal">#DEFINE INITSYS myINITSYS</code> // This will change the default INITSYS to myINITSYS.</p><p><code class="literal">#DEFINE INITSYS</code> // This will remove the INITSYS from the initialisation of the microcontroller.</p><p><span class="strong"><strong>Example to change LCD initialisation</strong></span></p><pre class="screen">    #DEFINE INITLCD myINITLCD

    Sub myInitLCD
        // do stuff
    End Sub</pre><p><span class="strong"><strong>Example to replace INITSYS</strong></span></p><pre class="screen">    #DEFINE INITSYS                      // Cancel call
    #STARTUP myInitSYS, 1               // New init routines, and set as highest priority

    Sub myInitSYS
        // do stuff
    End Sub</pre><p>Scripts can now change the #startup.&nbsp;&nbsp;  You can add a script to change the behaviour dependent on a specific condition ( the existant of another constant).</p><p>In user program</p><pre class="screen">    #DEFINE LCD_OCULAR_OM1614</pre><p>Supported within LCD.H</p><pre class="screen">    #SCRIPT
        If Def( LCD_OCULAR_OM1614 ) Then
            'Change INITLCD to specific Initialisation sub
            INITLCD = INIT_OCULAR_OM1614_LCD
        End if
    #ENDSCRIPT

    ......

    Sub INIT_OCULAR_OM1614_LCD
        .. lots of code
    End Sub</pre><p>will generate ASM like this&#8230;&#8203;</p><pre class="screen">    ;Program_memory_page: 0
        ORG	5
    BASPROGRAMSTART
    ;Call initialisation routines
        call	INITSYS
        call	INIT_OCULAR_OM1614_LCD

    ;Start_of_the_main_program</pre><p>This new capability to give you more control of the compiler.
<br>
<br></p><p><span class="strong"><strong>For more help, see:</strong></span> #define, #startup</p></div></body></html>