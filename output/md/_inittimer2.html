<html><head>
      <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
   <title>InitTimer2</title><link rel="stylesheet" type="text/css" href="gcbdoc.css"><meta name="generator" content="DocBook XSL Stylesheets V1.78.1"><link rel="home" href="index.html" title="GCBASIC documentation"><link rel="up" href="_timers.html" title="Timers"><link rel="prev" href="_inittimer1.html" title="InitTimer1"><link rel="next" href="_inittimer3.html" title="InitTimer3"></head><body bgcolor="white" text="black" link="#0000FF" vlink="#840084" alink="#0000FF"><div class="section"><div class="titlepage"><div><div><h4 class="title"><a name="_inittimer2"></a>InitTimer2</h4></div></div></div><p><span class="strong"><strong>Syntax: (MicroChip PIC)</strong></span></p><pre class="screen">    InitTimer2 <span class="emphasis"><em>prescaler</em></span>, <span class="emphasis"><em>postscaler</em></span>

or, where you required to state the clock source, use the following

    InitTimer2 <span class="emphasis"><em>clocksource</em></span>, <span class="emphasis"><em>prescaler</em></span>, <span class="emphasis"><em>postscaler</em></span></pre><p><span class="strong"><strong>Syntax: (Atmel AVR)</strong></span></p><pre class="screen">    InitTimer2 <span class="emphasis"><em>source</em></span>, <span class="emphasis"><em>prescaler</em></span></pre><p><span class="strong"><strong>Command Availability:</strong></span></p><p>Available on all microcontrollers with a Timer 2 module.&nbsp;&nbsp;As shown above a Microchip microcontroller can potentially support two types of methods for initialisation.
<br>
<br>
The first method is:
<br></p><pre class="screen">    InitTimer2 prescaler, postscaler</pre><p>This the most common method to initialise a Microchip microcontroller timer.&nbsp;&nbsp;With this method the timer has only one possible clock source, this mandated by the microcontrollers architecture, and that clock source is the System Clock/4 also known as FOSC/4.
<br>
<br>
<br>
The second method is much more flexible in term of the clock source.&nbsp;&nbsp;Microcontrollers that support this second method enable you to select different clock sources and to select more prescale values.&nbsp;&nbsp;The method is shown below:
<br></p><pre class="screen">    InitTimer2 clocksource, prescaler, postscaler</pre><p><span class="strong"><strong>How do you determine which method to use for your specific Microchip microcontroller ?</strong></span>
<br>
<br>
The timer type for a Microchip microcontroller can be determined by checking for the existance of a T2CLKCON register, either in the Datasheet or in the GCBASIC  "dat file" for the specific device.
<br>
<br>
If the Microchip microcontroller <span class="strong"><strong>DOES NOT</strong></span> have a T2CLKCON register then timers 2/4/6/8 for that specific microcontroller chip use the first method, and are configured using:
<br></p><pre class="screen">    InitTimer2 (PreScale, PostScale)</pre><p>If the microcontroller <span class="strong"><strong>DOES</strong></span> have a T2CLKCON register then ALL timers 2/4/6/8 for that specific microcontroller chip use the second method, and are configured using:</p><pre class="screen">    InitTimer2 (Source,PreScale,PostScale)</pre><p>The possible Source, Prescale and Postscale constants for each type are shown in the tables below.&nbsp;&nbsp;These table are summary tables from the Microchip datasheets.
<br>
<br></p><p><span class="strong"><strong>Period of the Timers</strong></span></p><p>The Period of the timer is determined by the system clock speed, the prescale value and 8-bit value in the respective timer period register.&nbsp;&nbsp;The timer period for timer 2 is held in register PR2.&nbsp;&nbsp;
<br></p><p>When the timer is enabled, by starting the timer, it will increment until the TMR2 register matches the value in the PR2 register.&nbsp;&nbsp;At this time the TMR2 register is cleared to 0 and the timer continues to increment until the next match, and so on.
<br></p><p>The lower the value of the PR2 register, the shorter the timer period will be.&nbsp;&nbsp;The default value for the PR2 register at power up is 255.
<br></p><p>The timer interrupt flag (TMR2IF) is set based upon the number of match conditions as determine by the postscaler.&nbsp;&nbsp;The postscaler does not actually change the timer period, it changes the time between interrupt conditions.
<br>
<br></p><p><span class="strong"><strong>Timer constants for the MicroChip microcontrollers</strong></span></p><p>Parameters for this timer are detailed in the tables below:</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th align="left" valign="top">Parameter</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal"><span class="emphasis"><em>clocksource</em></span></code></p></td><td align="left" valign="top"><p>This is an optional parameter.  Please review the datasheet for specific usage.<br>
&nbsp;<br>
Source can be one of the following numeric values:<br>
&nbsp;<br>
         1 equates to OSC (FOSC/4). &nbsp;&nbsp;&nbsp;The default clock source<br>
        <br>
         6 equates to EXTOSC same as SOSC<br>
         5 equates to MFINTOSC<br>
         4 equates to LFINTOSC<br>
         3 equates to HFINTOSC<br>
         2 equates to FOSC<br>
         1 equates to FOSC/4 same as OSC<br>
         0 equates to TxCKIPPS same as EXTOSC and EXT (T1CKIPPS)<br>
</p><p>Other sources may be available but can vary from microcontroller to microcontroller and these can be included manually per the specific microcontrollers datasheet.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal"><span class="emphasis"><em>prescaler</em></span></code></p></td><td align="left" valign="top"><p>The value of the prescaler for this specific timer.  See the tables below for permitted values.</p></td></tr><tr><td align="left" valign="top"><p><code class="literal"><span class="emphasis"><em>postscaler</em></span></code></p></td><td align="left" valign="top"><p>The value of the postscaler for this specific timer.  See the tables below for permitted values.</p></td></tr></tbody></table></div><p><span class="strong"><strong>Table 1 shown above</strong></span>
<br>
<br></p><p><code class="literal">prescaler</code> can be one of the following settings, if you MicroChip microcontroller has the T2CKPS4 bit then refer to table 3:</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th align="center" valign="top"><span class="strong"><strong>Prescaler Value</strong></span></th><th align="left" valign="top"><span class="strong"><strong>Primary GCB Constant</strong></span></th><th align="center" valign="top"><span class="strong"><strong>Constant Equates<br>
to value</strong></span></th></tr></thead><tbody><tr><td align="center" valign="top"><p>1:1</p></td><td align="left" valign="top"><p><code class="literal">PS2_1</code></p></td><td align="center" valign="top"><p>0</p></td></tr><tr><td align="center" valign="top"><p>1:4</p></td><td align="left" valign="top"><p><code class="literal">PS2_4</code></p></td><td align="center" valign="top"><p>1</p></td></tr><tr><td align="center" valign="top"><p>1:16</p></td><td align="left" valign="top"><p><code class="literal">PS2_16</code></p></td><td align="center" valign="top"><p>2</p></td></tr><tr><td align="center" valign="top"><p>1:64</p></td><td align="left" valign="top"><p><code class="literal">PS2_64</code></p></td><td align="center" valign="top"><p>3</p></td></tr></tbody></table></div><p><span class="strong"><strong>Table 2 shown above</strong></span>
<br>
<br>
Note that a 1:64 prescale is only avaialable on certain midrange microcontrollers.
Please refer to the datasheet to determine if a 1:64 prescale is supported by a
spectific microcontroller.
<br>
<br></p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th align="center" valign="top"><span class="strong"><strong>Prescaler Value</strong></span></th><th align="left" valign="top"><span class="strong"><strong>Primary GCB Constant</strong></span></th><th align="center" valign="top"><span class="strong"><strong>Constant Equates<br>
to value</strong></span></th></tr></thead><tbody><tr><td align="center" valign="top"><p>1:1</p></td><td align="left" valign="top"><p><code class="literal">PS2_1</code></p></td><td align="center" valign="top"><p>0</p></td></tr><tr><td align="center" valign="top"><p>1:2</p></td><td align="left" valign="top"><p><code class="literal">PS2_2</code></p></td><td align="center" valign="top"><p>1</p></td></tr><tr><td align="center" valign="top"><p>1:4</p></td><td align="left" valign="top"><p><code class="literal">PS2_4</code></p></td><td align="center" valign="top"><p>2</p></td></tr><tr><td align="center" valign="top"><p>1:8</p></td><td align="left" valign="top"><p><code class="literal">PS2_8</code></p></td><td align="center" valign="top"><p>3</p></td></tr><tr><td align="center" valign="top"><p>1:16</p></td><td align="left" valign="top"><p><code class="literal">PS2_16</code></p></td><td align="center" valign="top"><p>4</p></td></tr><tr><td align="center" valign="top"><p>1:32</p></td><td align="left" valign="top"><p><code class="literal">PS2_32</code></p></td><td align="center" valign="top"><p>5</p></td></tr><tr><td align="center" valign="top"><p>1:64</p></td><td align="left" valign="top"><p><code class="literal">PS2_64</code></p></td><td align="center" valign="top"><p>6</p></td></tr><tr><td align="center" valign="top"><p>1:128</p></td><td align="left" valign="top"><p><code class="literal">PS2_128</code></p></td><td align="center" valign="top"><p>7</p></td></tr></tbody></table></div><p><span class="strong"><strong>Table 3 shown above</strong></span>
<br>
<br></p><p><code class="literal"><span class="emphasis"><em>postscaler</em></span></code> slows the rate of the interrupt generation (or WDT reset) from a
counter/timer by dividing it down.</p><p>On Microchip PIC microcontroller one of the following constants where the Postscaler Rate Select bits are in the range of 1 to 16.</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"></colgroup><thead><tr><th align="left" valign="top"><span class="strong"><strong>Postcaler Value</strong></span></th><th align="left" valign="top"><span class="strong"><strong>GCB Constant</strong></span></th><th align="left" valign="top"><span class="strong"><strong>Eqautes to</strong></span></th></tr></thead><tbody><tr><td align="left" valign="top"><p>1:1 Postscaler</p></td><td align="left" valign="top"><p>POST_1</p></td><td align="left" valign="top"><p>0</p></td></tr><tr><td align="left" valign="top"><p>1:2 Postscaler</p></td><td align="left" valign="top"><p>POST_2</p></td><td align="left" valign="top"><p>1</p></td></tr><tr><td align="left" valign="top"><p>1:3 Postscaler</p></td><td align="left" valign="top"><p>POST_3</p></td><td align="left" valign="top"><p>2</p></td></tr><tr><td align="left" valign="top"><p>1:4 Postscaler</p></td><td align="left" valign="top"><p>POST_4</p></td><td align="left" valign="top"><p>3</p></td></tr><tr><td align="left" valign="top"><p>1:5 Postscaler</p></td><td align="left" valign="top"><p>POST_5</p></td><td align="left" valign="top"><p>4</p></td></tr><tr><td align="left" valign="top"><p>1:6 Postscaler</p></td><td align="left" valign="top"><p>POST_6</p></td><td align="left" valign="top"><p>5</p></td></tr><tr><td align="left" valign="top"><p>1:7 Postscaler</p></td><td align="left" valign="top"><p>POST_7</p></td><td align="left" valign="top"><p>6</p></td></tr><tr><td align="left" valign="top"><p>1:8 Postscaler</p></td><td align="left" valign="top"><p>POST_8</p></td><td align="left" valign="top"><p>7</p></td></tr><tr><td align="left" valign="top"><p>1:9 Postscaler</p></td><td align="left" valign="top"><p>POST_9</p></td><td align="left" valign="top"><p>8</p></td></tr><tr><td align="left" valign="top"><p>1:10 Postscaler</p></td><td align="left" valign="top"><p>POST_10</p></td><td align="left" valign="top"><p>9</p></td></tr><tr><td align="left" valign="top"><p>1:11 Postscaler</p></td><td align="left" valign="top"><p>POST_11</p></td><td align="left" valign="top"><p>10</p></td></tr><tr><td align="left" valign="top"><p>1:12 Postscaler</p></td><td align="left" valign="top"><p>POST_12</p></td><td align="left" valign="top"><p>11</p></td></tr><tr><td align="left" valign="top"><p>1:13 Postscaler</p></td><td align="left" valign="top"><p>POST_13</p></td><td align="left" valign="top"><p>12</p></td></tr><tr><td align="left" valign="top"><p>1:14 Postscaler</p></td><td align="left" valign="top"><p>POST_14</p></td><td align="left" valign="top"><p>13</p></td></tr><tr><td align="left" valign="top"><p>1:15 Postscaler</p></td><td align="left" valign="top"><p>POST_15</p></td><td align="left" valign="top"><p>14</p></td></tr><tr><td align="left" valign="top"><p>1:16 Postscaler</p></td><td align="left" valign="top"><p>POST_16</p></td><td align="left" valign="top"><p>15</p></td></tr></tbody></table></div><p><span class="strong"><strong>Table 4 shown above</strong></span></p><p><br>
<br></p><p><br>
<br></p><p><span class="strong"><strong>Explanation:(Atmel AVR)</strong></span></p><p><code class="literal">InitTimer2</code> will set up timer 2, according to the settings given.</p><p><code class="literal">source</code> can be one of the following settings:
Parameters for this timer are detailed in the table below:</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"></colgroup><thead><tr><th align="left" valign="top">Parameter</th><th align="left" valign="top">Description</th></tr></thead><tbody><tr><td align="left" valign="top"><p><code class="literal"><span class="emphasis"><em>source</em></span></code></p></td><td align="left" valign="top"><p>The clock source for this specific timer. Can be either <code class="literal">Osc</code> or <code class="literal">Ext</code> where`Osc` is an internal oscillator and <code class="literal">Ext</code> is an external oscillator.</p></td></tr></tbody></table></div><p><span class="strong"><strong>Table 5 shown above</strong></span>
<br>
<br></p><p><code class="literal">prescaler</code> for Atmel AVR Timer 2 is chip specific and can be selected from one of the two
tables shown below.  Please refer to the datasheet determine which table to use and which
prescales within that table are supported by a specific Atmel AVR microcontroller.</p><p>Table1: Prescaler Rate Select bits are in the range of 1 to 1024</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th align="center" valign="top"><span class="strong"><strong>Prescaler Value</strong></span></th><th align="left" valign="top"><span class="strong"><strong>Primary GCB Constant</strong></span></th><th align="left" valign="top"><span class="strong"><strong>Secondary GCB Constant</strong></span></th><th align="center" valign="top"><span class="strong"><strong>Constant Equates<br>
to value</strong></span></th></tr></thead><tbody><tr><td align="center" valign="top"><p>1:0</p></td><td align="left" valign="top"><p><code class="literal">PS_0</code></p></td><td align="left" valign="top"><p><code class="literal">PS_2_0</code></p></td><td align="center" valign="top"><p>1</p></td></tr><tr><td align="center" valign="top"><p>1:1</p></td><td align="left" valign="top"><p><code class="literal">PS_1</code></p></td><td align="left" valign="top"><p><code class="literal">PS_2_1</code></p></td><td align="center" valign="top"><p>1</p></td></tr><tr><td align="center" valign="top"><p>1:8</p></td><td align="left" valign="top"><p><code class="literal">PS_8</code></p></td><td align="left" valign="top"><p><code class="literal">PS_2_8</code></p></td><td align="center" valign="top"><p>2</p></td></tr><tr><td align="center" valign="top"><p>1:64</p></td><td align="left" valign="top"><p><code class="literal">PS_64</code></p></td><td align="left" valign="top"><p><code class="literal">PS_2_64</code></p></td><td align="center" valign="top"><p>3</p></td></tr><tr><td align="center" valign="top"><p>1:256</p></td><td align="left" valign="top"><p><code class="literal">PS_256</code></p></td><td align="left" valign="top"><p><code class="literal">PS2_256</code></p></td><td align="center" valign="top"><p>4</p></td></tr><tr><td align="center" valign="top"><p>1:1024</p></td><td align="left" valign="top"><p><code class="literal">PS_1024</code></p></td><td align="left" valign="top"><p><code class="literal">PS_2_1024</code></p></td><td align="center" valign="top"><p>5</p></td></tr></tbody></table></div><p><span class="strong"><strong>Table 6 shown above</strong></span>
<br>
<br>
<br></p><p>Prescaler Rate Select bits are in the range of 1 to 16384</p><div class="informaltable"><table border="1"><colgroup><col class="col_1"><col class="col_2"><col class="col_3"><col class="col_4"></colgroup><thead><tr><th align="center" valign="top"><span class="strong"><strong>Prescaler Value</strong></span></th><th align="left" valign="top"><span class="strong"><strong>Primary GCB Constant</strong></span></th><th align="left" valign="top"><span class="strong"><strong>Secondary GCB Constant</strong></span></th><th align="center" valign="top"><span class="strong"><strong>Constant Equates<br>
to value</strong></span></th></tr></thead><tbody><tr><td align="center" valign="top"><p>1:1</p></td><td align="left" valign="top"><p><code class="literal">PS_2_1</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>1</p></td></tr><tr><td align="center" valign="top"><p>1:2</p></td><td align="left" valign="top"><p><code class="literal">PS_2_2</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>2</p></td></tr><tr><td align="center" valign="top"><p>1:4</p></td><td align="left" valign="top"><p><code class="literal">PS_2_4</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>3</p></td></tr><tr><td align="center" valign="top"><p>1:8</p></td><td align="left" valign="top"><p><code class="literal">PS_2_8</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>4</p></td></tr><tr><td align="center" valign="top"><p>1:16</p></td><td align="left" valign="top"><p><code class="literal">PS_2_16</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>5</p></td></tr><tr><td align="center" valign="top"><p>1:32</p></td><td align="left" valign="top"><p><code class="literal">PS_2_32</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>6</p></td></tr><tr><td align="center" valign="top"><p>1:64</p></td><td align="left" valign="top"><p><code class="literal">PS_2_64</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>7</p></td></tr><tr><td align="center" valign="top"><p>1:128</p></td><td align="left" valign="top"><p><code class="literal">PS_2_128</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>8</p></td></tr><tr><td align="center" valign="top"><p>1:256</p></td><td align="left" valign="top"><p><code class="literal">PS_2_256</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>9</p></td></tr><tr><td align="center" valign="top"><p>1:512</p></td><td align="left" valign="top"><p><code class="literal">PS_2_512</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>10</p></td></tr><tr><td align="center" valign="top"><p>1:1024</p></td><td align="left" valign="top"><p><code class="literal">PS_2_1024</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>11</p></td></tr><tr><td align="center" valign="top"><p>1:2048</p></td><td align="left" valign="top"><p><code class="literal">PS_2_2048</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>12</p></td></tr><tr><td align="center" valign="top"><p>1:4096</p></td><td align="left" valign="top"><p><code class="literal">PS_2_4096</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>13</p></td></tr><tr><td align="center" valign="top"><p>1:8192</p></td><td align="left" valign="top"><p><code class="literal">PS_2_8192</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>14</p></td></tr><tr><td align="center" valign="top"><p>1:16384</p></td><td align="left" valign="top"><p><code class="literal">PS_2_16384</code></p></td><td align="left" valign="top"><p><code class="literal">none</code></p></td><td align="center" valign="top"><p>15</p></td></tr></tbody></table></div><p><span class="strong"><strong>Table 7 shown above</strong></span>
<br>
<br>
<span class="strong"><strong>Example:</strong></span></p><p>This code uses Timer 2 and On Interrupt to flash an LED every 200 timer ticks.</p><pre class="screen">    #chip 16F1788, 8

    #DEFINE LED PORTA.1
    DIR LED OUT

    #Define Match_Val PR2 'PR2 is the timer 2 match register
    Match_Val = 200       'Interrupt afer 200 timer ticks

    On interrupt timer2Match call FlashLED  'Interrupt on match
    Inittimer2 PS2_64, 15 'Prescale 1:64 /Postscale 1:16 (15)
    Starttimer 2

    Do
      ' Wating for interrupt on match val of 100
    Loop

    'This sub will be called when Timer 2 matches "Match_Val" (PR2)
    SUB FlashLED
        pulseout LED, 5 ms
    END SUB</pre></div></body></html>